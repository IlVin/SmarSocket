# Аппаратная часть

## Блок АЦП

### Определение количества каналов АЦП
Блок АЦП должен снимать показания со следующих датчиков:
* Датчик тока розетки №1
* Датчик тока розетки №2
* Датчик напряжения
* Другие датчики
Итого блок АЦП должен иметь не менее 4-х каналов.

### Требования к быстродействию АЦП

#### Параметры переменного тока, измеряемые АЦП
SmartSocket обладает функцией оценки качества тока в электрической сети.

Для полной оценки качества переменного тока нужно выполнить все измерения, изложенные
в ГОСТ 32144-2013. Однако, устройство, выполняющее измерения, описанные в стандарте,
является отдельным полноценным проектом.

Для определения потребляемой мощности приборами, подключенными к SmartSocket, нам необходимо
определить следующие параметры сетевого питания:
1) Частоту
2) Напряжение
3) Силу тока

Частота переменного тока в России жестко стандартизована и строго соблюдается
энергетическими компаниями. Соблюдение частоты жизненно необходимо для синхронизации
единой энергетической сети России. ГОСТ гласит:
```
отклонение частоты в синхронизированных системах электроснабжения не должно превышать
+/- 0,2 Гц в течение 95% времени интервала в одну неделю и +/- 0,4 Гц в течение
100% времени интервала в одну неделю
```
Поэтому примем частоту электрической сети равной 50 Гц и в этом проекте не будем её
измерять.

Измерение амплитуды напряжения актуально для России, так как РФ находится в процессе
перехода c 220В на 230В стандарт напряжения, согласно ГОСТ 29322-92. И не ясно в каком
регионе России уже перешли на 230В, а в каком все еще остаются на 220В.

**Итак, в этом проекте мы ограничимся измерением амплитуды сетевого напряжения и тока.**

#### Точность измерений

**Зададим точность измерения амплитуды переменного тока/напряжения 1%.**

#### Определение частоты дискретизации АЦП
Так как измерения мы проводим с помощью цифровой техники, то нам нужно преобразовать
непрерывную функцию значений датчика в цифровой вид. Для этого используется дискретизация
сигнала. Мы будем использовать равномерную дискретизацию.

![Дискретизация сигнала](quantization_levels.jpg)

На точность измерения сигнала влияет не только дискретизация сигнала, но и его квантование.
Квантование задается битностью АЦП.

**Примем, что наш АЦП может оцифровывать сигнал с квантованием не хуже 10 бит**

10 бит - это размах сигнала, равный 1024 единицам измерения. Очевидно, что погрешность
измерения равна 1 кванту.

Для сигнала, амплитуда которого равна максимальному измеряемому напряжению погрешность
измерения составит: `P = 100% - ((1024-1)/1024) * 100% = 0.1%`

Для сигнала, амплитуда которого равна `1/4` максимального измеряемого напряжения погрешность
измерения составит: `P = 100% - ((256-1)/256) * 100% = 0.4%`

Для сигнала, амплитуда которого равна `1/8` максимального измеряемого напряжения погрешность
измерения составит: `P = 100% - ((128-1)/128) * 100% = 0.8%`

Возьмем худший вариант, когда измеряемый сигнал равен `1/8` от максимального измеряемого и
погрешность квантования равна `0.8%`.

Определим частоту дискретизации, необходимую для измерения сигнала `1/4` от максимального
измеряемого c суммарной погрешностью 1%:
`1% - 0.8% = 0.2%`

![Косинусоида](cos.gif)

```
y = COS(x)

0.998 = COS(X)
X = ACOS(0.998) = 0.06

0.02 - 2Pi
T/2  - 0.06
T/2 = (0.02 * 0.06) / 2Pi
T   = (0.02 * 0.06) / Pi = 0.0004

Freq = 1/T = 1/0.0004 = 2617 Гц
```

### Варианты реализации АЦП
В качестве длока АЦП можно задействовать следующие технические решения:
1) Использовать имеющийся АЦП в МК ESP8266, дополнив его аналоговым мультиплексором
2) Использовать отдельную схему АЦП
3) В качестве АЦП исполдьзовать другой процессор, имеющий требуемое количество аналоговых каналов.



# Программная часть







# Литература
* 2
